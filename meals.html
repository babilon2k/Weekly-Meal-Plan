<!doctype html>
<html lang="pl" class="h-full bg-gray-900 text-gray-100">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meals Library ‚Äî Plan Posi≈Çk√≥w</title>
  <script src="https://unpkg.com/alpinejs@3.16.1/dist/cdn.min.js" defer></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/custom.css">
</head>
<body>
<nav class="bg-gradient-to-r from-green-600 to-green-400 text-gray-900 p-4">
  <div class="max-w-6xl mx-auto flex items-center justify-between">
    <div class="font-bold text-lg">Plan Posi≈Çk√≥w</div>
    <div class="space-x-4">
      <a href="meals.html" class="font-semibold">Meals Library</a>
      <a href="planer.html" class="font-semibold">Weekly Planner</a>
      <a href="shopping.html" class="font-semibold">Shopping List</a>
    </div>
  </div>
</nav>

<main class="max-w-6xl mx-auto p-6" x-data="mealsPage()">
  <header class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-extrabold">Biblioteka przepis√≥w</h1>
    <div class="text-sm text-gray-300">Projekt: <span class="font-semibold text-green-400">Babilon2k</span></div>
  </header>

  <div class="mb-4 flex gap-3">
    <input x-model="q" type="text" placeholder="Szukaj..." class="flex-1 bg-gray-800 text-gray-100 rounded p-2" @input.debounce="renderFiltered()" />
    <select x-model="filter" @change="renderFiltered()" class="bg-gray-800 p-2 rounded">
      <option value="all">Wszystkie</option>
      <option value="sniadania">≈öniadania</option>
      <option value="obiady">Obiady</option>
      <option value="kolacje">Kolacje</option>
    </select>
    <button @click="openAddModal" class="px-3 py-2 bg-green-500 rounded hover:shadow-[0_0_18px_#00c46a1a]">Dodaj przepis</button>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    <template x-for="meal in filtered" :key="meal.index">
      <div class="bg-gray-800 rounded-lg p-4 border border-gray-700 hover:shadow-[0_0_18px_#00c46a1a] transition cursor-pointer"
           @click="toggleSelect(meal)"
           :class="{'ring-2 ring-green-500/40': isSelected(meal)}">
        <div class="flex justify-between items-start">
          <h3 class="text-lg font-semibold" x-text="meal.title"></h3>
          <div class="text-sm text-gray-400" x-text="meal.category"></div>
        </div>
        <p class="text-sm text-gray-300 mt-2" x-text="shortIngredients(meal)"></p>
        <div class="mt-3 flex items-center justify-between">
          <div class="text-sm text-green-400 font-semibold" x-text="meal.macro.kcal + ' kcal'"></div>
          <div class="text-xs text-gray-400" x-text="'B:'+meal.macro.protein+' T:'+meal.macro.fat+' W:'+meal.macro.carbs"></div>
        </div>
      </div>
    </template>
  </div>

  <!-- add modal -->
  <div x-show="showAdd" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50" x-cloak>
    <div class="bg-gray-800 rounded-lg p-4 w-full max-w-2xl">
      <h3 class="font-semibold mb-2">Dodaj nowy przepis</h3>
      <div class="grid grid-cols-1 gap-2">
        <input x-model="new.title" placeholder="Tytu≈Ç" class="p-2 bg-gray-700 rounded" />
        <select x-model="new.category" class="p-2 bg-gray-700 rounded">
          <option value="sniadania">≈öniadania</option>
          <option value="obiady">Obiady</option>
          <option value="kolacje">Kolacje</option>
        </select>
        <input x-model="new.macroK" placeholder="kcal" class="p-2 bg-gray-700 rounded" />
        <input x-model="new.macroP" placeholder="bia≈Çko" class="p-2 bg-gray-700 rounded" />
        <input x-model="new.macroF" placeholder="t≈Çuszcz" class="p-2 bg-gray-700 rounded" />
        <input x-model="new.macroC" placeholder="wƒôglowodany" class="p-2 bg-gray-700 rounded" />
        <textarea x-model="new.ingredients" placeholder="Sk≈Çadniki (oddzielone nowƒÖ liniƒÖ)" class="p-2 bg-gray-700 rounded"></textarea>
        <div class="flex justify-end gap-2 mt-2">
          <button @click="showAdd=false" class="px-3 py-2 border rounded">Anuluj</button>
          <button @click="addNew()" class="px-3 py-2 bg-green-500 rounded">Dodaj</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="mt-8 text-sm text-gray-400">Projekt: Babilon2k</footer>
</main>

<script>
function mealsPage(){
  return {
    meals: [],
    filtered: [],
    q: '',
    filter: 'all',
    selected: new Set(),
    showAdd: false,
    new: {title:'', category:'sniadania', macroK:0, macroP:0, macroF:0, macroC:0, ingredients:''},
    init(){
      const cached = localStorage.getItem('meals_cache_v2');
      if(cached){ this.meals = JSON.parse(cached); this.renderFiltered(); return; }
      const nodes = Array.from(document.querySelectorAll('.meal-raw'));
      this.meals = nodes.map((n, idx)=>{
        const title = n.querySelector('h3').innerText.trim();
        const category = (n.dataset.category||'').toLowerCase();
        const macroRaw = n.dataset.macro || '';
        const [k,p,f,c] = macroRaw.split('|').map(x=>x?Number(x):0);
        const ingEl = n.querySelector('p.ingredients');
        const ingredientsText = ingEl ? ingEl.innerText.replace(/Sk≈Çadniki: ?/i,'').trim() : '';
        return {index: idx, title, category, macro: {kcal:k, protein:p, fat:f, carbs:c}, ingredientsText, html: n.innerHTML};
      });
      localStorage.setItem('meals_cache_v2', JSON.stringify(this.meals));
      this.renderFiltered();
    },
    renderFiltered(){
      const q = this.q.trim().toLowerCase();
      this.filtered = this.meals.filter(m => {
        const catOk = this.filter==='all' || m.category.includes(this.filter);
        const qOk = !q || m.title.toLowerCase().includes(q) || (m.ingredientsText||'').toLowerCase().includes(q);
        return catOk && qOk;
      });
    },
    shortIngredients(m){
      return (m.ingredientsText||'').split('\n').slice(0,2).join(' ‚Ä¢ ');
    },
    toggleSelect(m){
      if(this.selected.has(m.index)) this.selected.delete(m.index);
      else this.selected.add(m.index);
      localStorage.setItem('selected_meals_v2', JSON.stringify(Array.from(this.selected)));
      localStorage.setItem('meals_cache_v2', JSON.stringify(this.meals));
    },
    isSelected(m){ return this.selected.has(m.index); },
    openAddModal(){ this.showAdd=true; },
    addNew(){
      const idx = this.meals.length;
      const m = { index: idx, title: this.new.title, category: this.new.category, macro: {kcal: Number(this.new.macroK)||0, protein: Number(this.new.macroP)||0, fat: Number(this.new.macroF)||0, carbs: Number(this.new.macroC)||0}, ingredientsText: this.new.ingredients };
      this.meals.push(m);
      localStorage.setItem('meals_cache_v2', JSON.stringify(this.meals));
      this.showAdd=false;
      this.new = {title:'', category:'sniadania', macroK:0, macroP:0, macroF:0, macroC:0, ingredients:''};
      this.renderFiltered();
    }
  }
}
document.addEventListener('alpine:init', ()=>{});
</script>

<div style="display:none">

  <div class="meal-raw" data-category="sniadania" data-macro="506|28|9|77">
    <h3>FIT OWSIANKA (3 porcje + bia≈Çko x3)</h3>
    <p class="ingredients">Sk≈Çadniki:
450g skyra waniliowego
240g banana
210g bor√≥wek
150g p≈Çatk√≥w owsianych
150g mleka proteinowego
30g mas≈Ça orzechowego</p>
  </div>
  <div class="meal-raw" data-category="sniadania" data-macro="489|34|12|55">
    <h3>TWAR√ìG Z OWSIANKƒÑ I OWOCAMI (2 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
250g twarogu chudego
100g p≈Çatk√≥w owsianych
100g skyra waniliowego
30g mas≈Ça orzechowego
100g jab≈Çka
70g bor√≥wek</p>
  </div>
  <div class="meal-raw" data-category="sniadania" data-macro="560|34|13|77">
    <h3>GRANOLA Z OWOCAMI (3 porcje + bia≈Çko)</h3>
    <p class="ingredients">Sk≈Çadniki:
675g skyra naturalnego
240g banana
120g p≈Çatk√≥w owsianych
60g miodu
30g migda≈Ç√≥w
30g gorzkiej czekolady</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="658|62|25|40">
    <h3>DOMOWE QURRITO (2 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
300g piersi z kurczaka
2 tortille
50g cebuli czerwonej
2 og√≥rki kiszone
80g sera cheddar
60g sosu BBQ
5g oliwy z oliwek</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="745|0|0|0">
    <h3>SPICY CHIPOTLE CHICKEN MAC &amp; CHEESE (2 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
170g makaronu
400g piersi z kurczaka
250ml mleka
60g serka</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="597|59|16|52">
    <h3>HONEY GARLIC CHICKEN MAC &amp; CHEESE (4 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
800g piersi z kurczaka
30g mas≈Ça
30g miodu
300ml mleka
160g serka Philadelphia
220g makaronu</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="642|49|15|74">
    <h3>KREMOWY MAKARON Z PIECZONYCH POMIDOR√ìW üçÖ (3 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
500g pomidor√≥w koktajlowych
300g piersi z indyka
1 cebula
1 g≈Ç√≥wka czosnku
200g serka wiejskiego
240g makaronu</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="650|59|18|55">
    <h3>TANDOORI CHICKEN Z FRYTKAMI I COLESLAW (3 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
750g udek z kurczaka
750g ziemniak√≥w
240g kapusty
180g marchwi
60g jogurtu</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="390|34|4|54">
    <h3>SWEET CHILLI BU≈ÅECZKI Z KURCZAKIEM (6 sztuk)</h3>
    <p class="ingredients">Sk≈Çadniki:
450g piersi z kurczaka
przyprawy, mi√≥d, sriracha
400g jogurtu, 400g mƒÖki</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="526|48|15|50">
    <h3>SWEET CHILLI CHICKEN WRAP (4 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
600g piersi z kurczaka
1 papryka
4 tortille
100g serka ≈õmietankowego</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="495|50|3|68">
    <h3>KOREAN POPCORN CHICKEN (4 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
800g piersi z kurczaka
skrobia kukurydziana
sos sojowy</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="630|56|10|81">
    <h3>KURCZAK BBQ Z RY≈ªEM I SUR√ìWKƒÑ (3 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
600g piersi z kurczaka
210g ry≈ºu
80g sosu BBQ
400g kapusty czerwonej</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="630|80|13|45">
    <h3>INDYK W SOSIE SEROWYM (3 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
900g indyka
150g kaszy bulgur
200g serka wiejskiego</p>
  </div>
  <div class="meal-raw" data-category="obiady" data-macro="340|31|5|43">
    <h3>SKYROWE CHLEBKI Z KURCZAKIEM BBQ I SEREM üêî (8 sztuk)</h3>
    <p class="ingredients">Sk≈Çadniki:
600g piersi z kurczaka
400g mƒÖki
420g skyra
160g mozzarelli</p>
  </div>
  <div class="meal-raw" data-category="kolacje" data-macro="700|60|25|55">
    <h3>TOSTY Z TU≈ÉCZYKIEM I JAJKIEM (2 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
4 kromki chleba ≈ºytniego
200g tu≈Ñczyka
3 jajka</p>
  </div>
  <div class="meal-raw" data-category="kolacje" data-macro="695|52|27|55">
    <h3>WRAPY Z ≈ÅOSOSIEM I TWAROGIEM (2 porcje)</h3>
    <p class="ingredients">Sk≈Çadniki:
2 tortille
200g ≈Çososia wƒôdzonego
200g twarogu</p>
  </div>

</div>
</body>
</html>
